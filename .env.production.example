# CyberX Event Management System - Production Environment Configuration
# Copy this file to .env.production and update with your production values

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
POSTGRES_DB=cyberx_events
POSTGRES_USER=cyberx
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE

# Full database URL (used by application)
DATABASE_URL=postgresql+asyncpg://cyberx:CHANGE_ME_STRONG_PASSWORD_HERE@postgres:5432/cyberx_events

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
# Note: Redis not needed for single-instance deployment with Render + Supabase
# REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
# REDIS_URL=redis://:CHANGE_ME_REDIS_PASSWORD@redis:6379/0

# ============================================================================
# APPLICATION SECURITY
# ============================================================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(64))"
SECRET_KEY=CHANGE_ME_64_CHARACTER_RANDOM_STRING

# Optional separate CSRF key (defaults to SECRET_KEY if not set)
CSRF_SECRET_KEY=CHANGE_ME_64_CHARACTER_RANDOM_STRING

# Optional field encryption key (Fernet key)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ENCRYPTION_KEY=CHANGE_ME_44_CHARACTER_FERNET_KEY

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
DEBUG=False
ALLOWED_HOSTS=events.cyberxredteam.org,www.events.cyberxredteam.org
FRONTEND_URL=https://events.cyberxredteam.org

# Session configuration
SESSION_EXPIRY_HOURS=24

# ============================================================================
# EMAIL CONFIGURATION (SENDGRID)
# ============================================================================
SENDGRID_API_KEY=SG.CHANGE_ME_YOUR_SENDGRID_API_KEY
SENDGRID_FROM_EMAIL=noreply@cyberxredteam.org
SENDGRID_FROM_NAME=CyberX Red Team
SENDGRID_SANDBOX_MODE=false

# Webhook Security (RECOMMENDED for production)
# Get from: SendGrid Dashboard → Settings → Mail Settings → Event Webhook → Signature Verification
SENDGRID_WEBHOOK_VERIFICATION_KEY=CHANGE_ME_VERIFICATION_KEY_FROM_SENDGRID

# Email job configuration
BULK_EMAIL_INTERVAL_MINUTES=45

# ============================================================================
# REMINDER CONFIGURATION
# ============================================================================
REMINDER_1_DAYS_AFTER_INVITE=7
REMINDER_1_MIN_DAYS_BEFORE_EVENT=14
REMINDER_2_DAYS_AFTER_INVITE=14
REMINDER_2_MIN_DAYS_BEFORE_EVENT=7
REMINDER_3_DAYS_BEFORE_EVENT=3
REMINDER_CHECK_INTERVAL_HOURS=24

# ============================================================================
# VPN CONFIGURATION
# ============================================================================
VPN_SERVER_PUBLIC_KEY=CHANGE_ME_WIREGUARD_PUBLIC_KEY
VPN_SERVER_ENDPOINT=vpn.cyberxredteam.org:51820
VPN_DNS_SERVERS=10.20.200.1
VPN_ALLOWED_IPS=10.0.0.0/8,fd00:a::/32

# ============================================================================
# POWERDNS CONFIGURATION (OPTIONAL)
# ============================================================================
POWERDNS_API_URL=https://dns.cyberxredteam.org/api/v1/pdnsadmin/
POWERDNS_USERNAME=admin
POWERDNS_PASSWORD=CHANGE_ME_POWERDNS_PASSWORD

# ============================================================================
# KEYCLOAK INTEGRATION (OPTIONAL)
# ============================================================================
# Required for syncing participant credentials to Keycloak SSO.
# Leave PASSWORD_SYNC_ENABLED=false until Keycloak is fully stood up and reachable.
# The sync job gracefully handles Keycloak being unreachable — connectivity errors
# do not consume retries, and the job will succeed on the next interval once Keycloak is up.
#
# Setup steps:
#   1. Create a confidential client in Keycloak (e.g. "admin-cli") with service account enabled
#   2. Assign the client the "manage-users" realm role (or a custom role with user CRUD)
#   3. Set KEYCLOAK_URL to your Keycloak base URL (no trailing slash)
#   4. Set KEYCLOAK_ADMIN_CLIENT_SECRET to the client's secret
#   5. Set PASSWORD_SYNC_ENABLED=true when ready to start syncing
KEYCLOAK_URL=https://auth.cyberxredteam.org
KEYCLOAK_REALM=cyberx
KEYCLOAK_ADMIN_CLIENT_ID=admin-cli
KEYCLOAK_ADMIN_CLIENT_SECRET=CHANGE_ME_KEYCLOAK_CLIENT_SECRET
KEYCLOAK_WEBHOOK_SECRET=CHANGE_ME_WEBHOOK_HMAC_SECRET
PASSWORD_SYNC_ENABLED=false
PASSWORD_SYNC_INTERVAL_MINUTES=5
PASSWORD_SYNC_MAX_RETRIES=5

# ============================================================================
# DISCORD INTEGRATION (OPTIONAL)
# ============================================================================
# Required for generating per-event, single-use Discord invite links for confirmed participants.
# Each event can target a different Discord channel via the discord_channel_id field on the event.
#
# Setup steps:
#   1. Create a Discord bot at https://discord.com/developers/applications
#   2. Enable the bot and copy its token
#   3. Invite the bot to your server with "Create Instant Invite" permission
#   4. Set the discord_channel_id on the event via the admin API
#   5. Set DISCORD_INVITE_ENABLED=true
DISCORD_BOT_TOKEN=CHANGE_ME_DISCORD_BOT_TOKEN
DISCORD_INVITE_ENABLED=false

# ============================================================================
# MONITORING (OPTIONAL)
# ============================================================================
GRAFANA_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30

# ============================================================================
# DEPLOYMENT INFORMATION
# ============================================================================
DEPLOY_ENVIRONMENT=production
DEPLOY_VERSION=0.1.0-beta
DEPLOY_DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
